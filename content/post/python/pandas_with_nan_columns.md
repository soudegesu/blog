---
title: "PandasでNaNの列を処理する"
description: ""
date: "2018-10-15T08:39:08+09:00"
thumbnail: /images/icons/python_icon.png
categories:
  - "python"
tags:
  - "python"
  - "pandas"
draft: true
isCJKLanguage: true
twitter_card_image: /images/icons/python_icon.png
---

[Pandas](https://pandas.pydata.org/) でデータを扱うことで、データ分析の前処理が格段に楽になります。

列データにおける `NaN` の処理を例に、便利さの説明をします。

## NaNとは

**NaN（Not a Number）** は浮動小数点型における異常な値のことを意味します。
わかりやすい例で言うと、0での割り算が該当します。これは実数では表せないため、 `NaN` になります。

[Pandas](https://pandas.pydata.org/) において `NaN` は **値が欠損している** 場合によく遭遇する表現です。
具体例で見ていきましょう。以下のようなサンプルデータ（`sample.csv`）を作成します。

```csv
ID,名前,年齢,性別,趣味
1,小林,20,男,野球観戦
2,田中,35,女,飲み会
3,佐藤,29,男
4,鈴木,44,女,編み物
```

データを `read_csv` 関数で読み出して `DataFrame` とした後、表示してみます。

```python
import pandas as pd

df = pd.read_csv('./sample.csv')
df.head()
```

佐藤さんは **趣味** の列のデータが欠損しているので `NaN` と表示されていますね。


|   |ID	|名前	|年齢	|性別	|趣味|
|---|---|-----|----|----|---|
|0	|1	|小林	 |20	|男	 |野球観戦|
|1	|2	|田中	 |35	|女	 |飲み会|
|2	|3	|佐藤	 |29	|男	 |NaN|
|3	|4	|鈴木	 |44	|女	 |編み物|


例えば、**必須回答** と **任意回答** の項目があるアンケート分析の場面においては、任意回答項目の列に `NaN` が頻出することは想像に難くないでしょう。
要件に応じて欠損値を正しく処理するのは、とても重要な作業です。

以下では `NaN` のハンドリグをまとめていきます。

## 各列にNaNが存在するかを確認する

まずは、各列の中に `NaN` があるかをパッと判断できると嬉しいでしょう。`isna` 関数を使えば簡単に確認できます。

```python
df.isna().any()

> ID    False
> 名前    False
> 年齢    False
> 性別    False
> 趣味     True
```

`any()` と組み合わせることで、**1つでもNaNがあればTrue** と出力指定ができます。
上の出力で言えば、**趣味** のカラムは1つ以上欠損しているので `True` です。

`df.isna().all()` としてしまうと、 **全ての値がNaNであればTrue** となってしまうので、注意しましょう。

## 各列にNaNが何件あるかを確認する

`NaN` が何件あるかを確認したい場合には `sum()` を使えば良い。

```python
df.isna().sum()

> ID    0
> 名前    0
> 年齢    0
> 性別    0
> 趣味    1
> dtype: int64
```

## NaNの取り扱いを決める

次に実際に `NaN` となっているデータの取扱を考えます。

### NaNが存在する行を削除する

以下は、全ての列に対して1つでも `NaN` がある行を削除する例です。

```python
df[df.isna().any(axis=1) == False]
```

`axis=1` とすることで、行に対する `True/False` を取得している点が肝になります。
Falseとなっている行、つまり、 `NaN` が存在しない行のみ表示しています。

これは以下の処理と等価です。

```python
df.dropna(axis=0)
```

しかし実際問題、 全ての列においてNaN判定をする処理はあまり見かけないので、 **特定の列がNaNの行を削除** する場合には以下のようにします。

```python
# ここでは「趣味」列を対象にする
df[df['趣味'].isna() == False]
```

### NaNに対してデフォルト値を設定する

`NaN` のデータに対してデフォルト値を設定するには `fillna` 関数を使います。

```python
df.fillna({'趣味': 'なし'})
```
